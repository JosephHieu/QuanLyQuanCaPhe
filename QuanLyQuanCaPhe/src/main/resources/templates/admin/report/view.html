<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Th·ªëng k√™, B√°o c√°o</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
    <link rel="stylesheet" th:href="@{/css/report.css}" />

</head>
<body>
<div th:insert="~{fragments/header :: header}"></div>
<div class="page-container">
    <div class="sidebar-wrapper">
        <div th:insert="~{fragments/sidebar :: sidebar}"></div>
        <div th:insert="~{fragments/footer :: footer}"></div>
    </div>
    <main class="main-content">
        <div class="breadcrumb">Th·ªëng k√™, b√°o c√°o</div>

<form th:action="@{/admin/reports}" method="get" class="filter-section">

    <div class="filter-group">
        <label>Ch·ªçn m·ª•c:</label>
        <label><input type="radio" name="reportType" value="T·∫•t c·∫£" th:checked="${reportTypeSelected == 'T·∫•t c·∫£'}"> T·∫•t c·∫£</label>
        <label><input type="radio" name="reportType" value="Nh·∫≠p-xu·∫•t" th:checked="${reportTypeSelected == 'Nh·∫≠p-xu·∫•t'}"> Nh·∫≠p-xu·∫•t</label>
        <label><input type="radio" name="reportType" value="Nh·∫≠p" th:checked="${reportTypeSelected == 'Nh·∫≠p'}"> Nh·∫≠p</label>
        <label><input type="radio" name="reportType" value="B√°n h√†ng" th:checked="${reportTypeSelected == 'B√°n h√†ng'}"> B√°n h√†ng</label>
        <label><input type="radio" name="reportType" value="L∆∞∆°ng" th:checked="${reportTypeSelected == 'L∆∞∆°ng'}"> L∆∞∆°ng</label>
        <label><input type="radio" name="reportType" value="TT nh√¢n vi√™n" th:checked="${reportTypeSelected == 'TT nh√¢n vi√™n'}"> TT nh√¢n vi√™n</label>
        <label><input type="radio" name="reportType" value="Xu·∫•t" th:checked="${reportTypeSelected == 'Xu·∫•t'}"> Xu·∫•t</label>
        <label><input type="radio" name="reportType" value="Ph√≠ kh√°c" th:checked="${reportTypeSelected == 'Ph√≠ kh√°c'}"> Ph√≠ kh√°c</label>
    </div>

    <div class="date-filter">
        <label for="startDate">T·ª´ ng√†y:</label>
        <input type="date" id="startDate" name="startDate" th:value="${startDateSelected}" />
        <span class="calendar-icon">üóìÔ∏è</span>

        <label for="endDate" style="margin-left: 15px;">ƒë·∫øn ng√†y:</label>
        <input type="date" id="endDate" name="endDate" th:value="${endDateSelected}" />
        <span class="calendar-icon">üóìÔ∏è</span>

        <button type="submit" style="margin-left: 15px;">Xem</button>
    </div>
</form>

        <div class="report-table">

            <div th:if="${isThuChiReport == true}">
                <h4>B√°o c√°o Thu - Chi (T·ªïng h·ª£p t·ª´ H√≥a ƒë∆°n v√† Chi ti√™u)</h4>
                <table>
                    <thead>
                    <tr>
                        <th>Ng√†y</th>
                        <th class="number-col">Thu <span class="sort-arrow">‚óÜ</span></th>
                        <th class="number-col">Chi <span class="sort-arrow">‚óÜ</span></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="ngay : ${dto.chiTietTheoNgay}">
                        <td th:text="${#temporals.format(ngay.ngay, 'dd/MM/yyyy')}"></td>
                        <td class="number-col" th:text="${#numbers.formatDecimal(ngay.tongThu, 0, 'COMMA', 0, 'POINT')}"></td>
                        <td class="number-col" th:text="${#numbers.formatDecimal(ngay.tongChi, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(dto.chiTietTheoNgay)}">
                        <td colspan="3" style="text-align: center; font-style: italic;">Kh√¥ng c√≥ d·ªØ li·ªáu thu chi trong kho·∫£ng th·ªùi gian n√†y.</td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td><strong>T·ªïng</strong></td>
                        <td class="number-col"><strong th:text="${#numbers.formatDecimal(dto.tongThuCong, 0, 'COMMA', 0, 'POINT')}"></strong></td>
                        <td class="number-col"><strong th:text="${#numbers.formatDecimal(dto.tongChiCong, 0, 'COMMA', 0, 'POINT')}"></strong></td>
                    </tr>
                    </tfoot>
                </table>
            </div>

            <div th:if="${isLuongReport == true}">
                <h4>B√°o c√°o L∆∞∆°ng nh√¢n vi√™n (To√†n th·ªùi gian)</h4>
                <table>
                    <thead>
                    <tr>
                        <th class="stt-col">Stt</th>
                        <th>H·ªç t√™n</th>
                        <th>Ch·ª©c v·ª•</th>
                        <th class="number-col">L∆∞∆°ng</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="nv, iterStat : ${dsNhanVien}">
                        <td class="stt-col" th:text="${iterStat.count}"></td>
                        <td th:text="${nv.hoTen}"></td>
                        <td th:text="${nv.chucVu?.tenChucVu}"></td> <td class="number-col" th:text="${#numbers.formatDecimal(nv.chucVu?.luong, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(dsNhanVien)}">
                        <td colspan="4" style="text-align: center; font-style: italic;">Kh√¥ng c√≥ nh√¢n vi√™n n√†o.</td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right;"><strong>T·ªïng c·ªông</strong></td>
                        <td class="number-col">
                            <strong th:text="${#numbers.formatDecimal(tongLuong, 0, 'COMMA', 0, 'POINT')}"></strong>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>

        </div>

<div class="export-section">
    <div>
        <h5>Xu·∫•t file</h5>
        <label><input type="radio" name="exportFormat" value="txt"> .txt - Text File</label>
        <label><input type="radio" name="exportFormat" value="xls" checked> .xls - Excel File</label>
        <label><input type="radio" name="exportFormat" value="sql"> .sql - SQL File</label>
        <button type="button" onclick="exportFile()">Xu·∫•t file</button>
    </div>

    <!-- M√°y in   -->
    <div>
        <h5>In file</h5>
        <label for="printPaperSize">Kh·ªï gi·∫•y:</label>
        <select id="printPaperSize" style="padding: 5px; width: 100px;">
            <option>A4</option>
            <option>A5</option>
        </select>
        <label for="printPrinterName" style="margin-top: 10px;">M√°y in:</label>
        <select id="printPrinterName" style="padding: 5px; width: 150px;">
            <option>HP Laser</option>
            <option>Canon XL</option>
        </select>
        <label for="printCopies" style="margin-top: 10px;">S·ªë l∆∞·ª£ng:</label>
        <input type="number" id="printCopies" value="3" style="padding: 5px; width: 50px;">
        <button type="button" onclick="alert('Ch·ª©c nƒÉng In file ƒëang ph√°t tri·ªÉn')">In</button>
    </div>
</div>

</main>
</div>

<script th:inline="javascript">
    function exportFile() {
        // 1. L·∫•y t·∫•t c·∫£ gi√° tr·ªã l·ªçc hi·ªán t·∫°i
        const reportType = document.querySelector('input[name="reportType"]:checked')?.value || 'T·∫•t c·∫£';
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const exportFormat = document.querySelector('input[name="exportFormat"]:checked')?.value || 'xls';

        // 2. Ki·ªÉm tra ng√†y (b·∫Øt bu·ªôc)
        if (!startDate || !endDate) {
            alert('Vui l√≤ng ch·ªçn "T·ª´ ng√†y" v√† "ƒê·∫øn ng√†y" tr∆∞·ªõc khi xu·∫•t file.');
            return;
        }

        // 3. X√¢y d·ª±ng URL cho endpoint export
        const url = new URL(window.location.origin + '/admin/reports/export');
        url.searchParams.append('reportType', reportType);
        url.searchParams.append('startDate', startDate);
        url.searchParams.append('endDate', endDate);
        url.searchParams.append('exportFormat', exportFormat);

        console.log('ƒêang g·ªçi URL xu·∫•t file:', url.href);

        // 4. G·ªçi URL -> Tr√¨nh duy·ªát s·∫Ω t·ª± ƒë·ªông t·∫£i file v·ªÅ
        window.location.href = url.href;
    }
</script>
</body>
</html>