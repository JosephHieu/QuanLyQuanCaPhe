<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Xu·∫•t H√†ng h√≥a</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
    <link rel="stylesheet" th:href="@{/css/products.css}" />

</head>
<body>
<div th:insert="~{fragments/header :: header}"></div>
<div class="page-container">
    <div class="sidebar-wrapper">
        <div th:insert="~{fragments/sidebar :: sidebar}"></div>
        <div th:insert="~{fragments/footer :: footer}"></div>
    </div>

    <main class="main-content">
        <div class="breadcrumb">Xu·∫•t h√†ng h√≥a</div>

        <form th:action="@{/admin/khohang/xuat/save}" method="post">

            <div th:if="${errorMessage}" class="global-error-message">
                <strong th:text="${errorMessage}"></strong>
            </div>

            <div class="form-grid">
                <label for="maHangHoa">T√™n h√†ng:</label>
                <select id="maHangHoa" name="maHangHoa" required onchange="updateUnit()">
                    <option value="">-- Ch·ªçn h√†ng h√≥a --</option>
                    <option th:each="hh : ${dsHangHoa}"
                            th:value="${hh.maHangHoa}"
                            th:text="${hh.tenHangHoa + ' (T·ªìn: ' + hh.soLuong + ')'}"
                            th:attr="data-unit=${hh.donViTinh?.tenDonVi}, data-max=${hh.soLuong}"
                            th:selected="${hh.maHangHoa == maHangHoaSelected}">
                    </option>
                </select>

                <label for="soLuong">S·ªë l∆∞·ª£ng:</label>
                <div class="input-group">
                    <input type="number" id="soLuong" name="soLuong" min="1" required th:value="${soLuong ?: 1}" />
                    <span id="unitDisplay">(ƒë∆°n v·ªã)</span> <span class="spin-buttons">‚ÜïÔ∏è</span>
                </div>

                <label for="ngayXuat">Ng√†y xu·∫•t:</label>
                <div class="input-group">
                    <input type="date" id="ngayXuat" name="ngayXuat" required th:value="${ngayXuat ?: ngayXuatDefault}" />
                    <span class="calendar-icon">üóìÔ∏è</span>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit">ƒê·ªìng √Ω</button>
                <a th:href="@{/admin/khohang}">H·ªßy</a>
            </div>
        </form>
    </main>
</div>

<script>
    const hangHoaSelect = document.getElementById('maHangHoa');
    const soLuongInput = document.getElementById('soLuong');
    const unitDisplay = document.getElementById('unitDisplay');

    function updateUnit() {
        const selectedOption = hangHoaSelect.options[hangHoaSelect.selectedIndex];
        const unit = selectedOption.getAttribute('data-unit');
        const max = selectedOption.getAttribute('data-max');

        unitDisplay.textContent = unit ? `(${unit})` : '(ƒë∆°n v·ªã)';
        if (max) {
            soLuongInput.max = max; // Set max cho input s·ªë l∆∞·ª£ng
            // Optional: Reset s·ªë l∆∞·ª£ng n·∫øu v∆∞·ª£t qu√° max
            if (parseInt(soLuongInput.value) > parseInt(max)) {
                soLuongInput.value = max;
            }
        } else {
            soLuongInput.removeAttribute('max');
        }
    }

    // G·ªçi l·∫ßn ƒë·∫ßu khi trang load ƒë·ªÉ hi·ªÉn th·ªã ƒë√∫ng ƒë∆°n v·ªã (n·∫øu c√≥ h√†ng ƒë∆∞·ª£c ch·ªçn s·∫µn do l·ªói)
    updateUnit();

    // C·∫≠p nh·∫≠t max khi s·ªë l∆∞·ª£ng thay ƒë·ªïi (ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng v∆∞·ª£t qu√°)
    soLuongInput.addEventListener('input', function() {
        const max = parseInt(this.max);
        if (!isNaN(max) && parseInt(this.value) > max) {
            this.value = max;
        }
        if (parseInt(this.value) < 1 && this.value !== '') {
            this.value = 1; // Gi·ªØ t·ªëi thi·ªÉu l√† 1
        }
    });

</script>
</body>
</html>